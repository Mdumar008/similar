<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="data-defaults.js"></script>
</head>
<body>
  <div class="login-container" id="login">
    <h2>Admin Login</h2>
    <input id="adminPass" type="password" placeholder="Password"/>
    <button onclick="login()">Login</button>
  </div>

  <div class="dashboard" id="dashboard">
    <div class="tab-buttons">
      <button data-tab="global" class="active">Global</button>
      <button data-tab="pages">Pages</button>
      <button data-tab="products">Products</button>
    </div>

    <!-- Global Settings -->
    <div id="global" class="admin-section active">
      <h3>Global Settings</h3>
      <label>Logo URL<input id="gLogo"/></label>
      <label>Tagline<input id="gTagline"/></label>
      <button onclick="saveGlobal()">Save Global</button>
    </div>

    <!-- Page Titles & Content -->
    <div id="pages" class="admin-section">
      <h3>Page Content</h3>
      <select id="pageSelect" onchange="loadPageEditor()">
        <option value="index">Home</option>
        <option value="about">About</option>
        <option value="hos">Hospitality</option>
        <option value="sta">Services</option>
      </select>
      <label>Title<input id="pTitle"/></label>
      <label>Content<textarea id="pContent" rows="6"></textarea></label>
      <button onclick="savePage()">Save Page</button>
    </div>

    <!-- Product Management -->
    <div id="products" class="admin-section">
      <h3>Products</h3>
      <form id="prodForm">
        <label>Category<input id="prodCat"/></label>
        <label>Name<input id="prodName"/></label>
        <label>Description<textarea id="prodDesc" rows="3"></textarea></label>
        <label>Image<input id="prodImg" type="file" accept="image/*"/></label>
        <button type="submit">Add Product</button>
      </form>
      <div id="prodList"></div>
    </div>
  </div>

  <script>
    let site = JSON.parse(localStorage.getItem("siteData"))||DEFAULT_DATA;
    function login(){
      if(adminPass.value!=="admin123") return alert("Wrong");
      login.style.display="none";
      dashboard.style.display="block";
      initTabs(); loadGlobal(); loadPageEditor(); loadProducts();
    }
    function initTabs(){
      document.querySelectorAll(".tab-buttons button").forEach(btn=>{
        btn.onclick=()=>{
          document.querySelectorAll(".tab-buttons button").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          document.querySelectorAll(".admin-section").forEach(s=>s.classList.remove("active"));
          document.getElementById(btn.dataset.tab).classList.add("active");
        };
      });
    }
    function saveData(){ localStorage.setItem("siteData",JSON.stringify(site)); }

    // Global
    function loadGlobal(){
      gLogo.value = site.global.logo;
      gTagline.value = site.global.tagline;
    }
    function saveGlobal(){
      site.global.logo = gLogo.value;
      site.global.tagline = gTagline.value;
      saveData(); alert("Global saved");
    }

    // Pages
    function loadPageEditor(){
      const key = pageSelect.value;
      pTitle.value = site.pages[key].title;
      pContent.value = site.pages[key].content;
    }
    function savePage(){
      const key = pageSelect.value;
      site.pages[key].title   = pTitle.value;
      site.pages[key].content = pContent.value;
      saveData(); alert("Page saved");
    }

    // Products
    prodForm.addEventListener("submit", e=>{
      e.preventDefault();
      const file = prodImg.files[0];
      if(!file) return alert("Pick image");
      const reader = new FileReader();
      reader.onload = ()=> {
        site.products.push({
          category: prodCat.value,
          name: prodName.value,
          desc: prodDesc.value,
          image: reader.result
        });
        saveData(); loadProducts(); prodForm.reset();
      };
      reader.readAsDataURL(file);
    });
    function loadProducts(){
      prodList.innerHTML = site.products.map((p,i)=>`
        <div class="product-card">
          <img src="${p.image}" width="60"/>
          <strong>${p.name}</strong>(${p.category})
          <p>${p.desc}</p>
          <button onclick="delProd(${i})">Delete</button>
        </div>
      `).join("")||"<p>No products.</p>";
    }
    function delProd(i){
      site.products.splice(i,1);
      saveData(); loadProducts();
    }
  </script>
</body>
</html>
